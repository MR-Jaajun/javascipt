"use strict";$(function(){var t=decodeURI(location.search).slice(1);$("#keyword").val(t);var i=getCookie("username");if(i){$("#login").css("display","none"),$("#registers").css("display","none");setTimeout(function(){$("#loginName").html(i).css("display","inline-block"),$("#loginout").css("display","inline-block")},1500)}else $("#login").css("display","block"),$("#registers").css("display","block"),$("#loginName").css("display","none"),$("#loginout").css("display","none");$("#loginout a").click(function(){removeCookie("username","",-1),$("#loginName").css("display","none"),$("#loginout").css("display","none"),location.href="../main.html"}),$(".top .citytab span").hover(function(){$(this).addClass("active").siblings().removeClass();var t=$(this).index();$(".top .citylist").eq(t).addClass("listblock").siblings().removeClass("listblock")}),$("#nav .catalogs").hover(function(){$("#nav .catalogs .catalogs-list").css({display:"block",height:"463"})},function(){$("#nav .catalogs .catalogs-list").css("display","none")}),$("#nav .catalogs-list .item").hover(function(){var t=$(this).index();$("#nav .catalogs-list .item .sub-item").eq(t).addClass("itemblock")},function(){var t=$(this).index();$("#nav .catalogs-list .item .sub-item").eq(t).removeClass("itemblock")});var s=$("#logo").outerHeight();$(window).scroll(function(){var t=window.scrollY;s<t?$("#logo").addClass("fix"):$("#logo").removeClass("fix"),500<t?$("#backtop .topbtn").css("display","block"):$("#backtop .topbtn").css("display","none"),310<t?$("#floor-jump").css("display","block"):$("#floor-jump").css("display","none")});var c=12,e=0,l=0,a="",n="";function o(t){var i=JSON.parse(t),s=i.glist.map(function(t){return'<li class="listinf" data-id="'+t.gid+'">\n\t                        <div class="p_img">\n\t                            <a href="javascript:" target="_blank">\n\t                                <img src="'+t.img+'" width="290" height="290" class="j_product_img">\n\t                            </a>\n\t                        </div>\n\t                        <div class="p_info clearfix">\n\t                            <div class="p_name"><a href="javascript:" target="_blank">'+t.ginfo+'/个</a></div>\n\t                            <div class="p_price">\n\t                                <span class="price">\n\t                                    <strong>¥'+t.gprice+'</strong>\n\t                                </span>   \n\t                            </div>\n\t                        </div>\n\t                        <div class="p-buy">\n\t                            <span>'+t.gdescribe+'</span>\n\t\t\t\t\t\t\t\t<a class="btn-buy" href="javascript:;">加入购物车</a>\n\t                        </div>\n\t                    </li>'}).join("");$("#list").html(s),l=Math.ceil(i.total/c);for(var a="",n=0;n<l;n++)a+='<a href="javascript:;">'+(n+1)+"</a>";$("#btn .btn").html(a),$(".btn").find("a").eq(i.page-1).addClass("active"),e=i.page}function r(t,i){$.ajax({type:"get",url:"../api/list.php",async:!0,data:{page:t,num:c,typ:a,order:i,find:p},success:function(t){o(t)}})}$("#btn").append('<input type="button" class="up" id="up" value="上一页" />'),$("#btn").append('<input type="button" class="down" id="down" value="下一页" />'),$("#btn").on("click","#up",function(){--e<1&&(e=1),r(e,n)}),$("#btn").on("click","#down",function(){l<++e&&(e=l),r(e,n)}),r(1,""),$(".filter_sort .on").click(function(){d=!1,a="",$.ajax({type:"get",url:"../api/list.php",async:!0,data:{page:1,num:12},success:function(t){o(t)}}),$(".sort_down").css("background-position","-20px 0"),$(".select li").children().removeClass("active")}),$("#btn").on("click",".btn a",function(){r($(this).index()+1,n)});var p="",d=!1;$(".select li").click(function(){$(this).children().addClass("active"),$(this).siblings().children().removeClass("active"),d=!0,p=$(this).children().html(),$.ajax({type:"get",url:"../api/list.php",async:!0,data:{find:p},success:function(t){o(t),$(".btn").find("a").eq(0).addClass("active").siblings().removeClass("active")}})});var u=!0;$(".filter_sort .price").click(function(){a="gprice",u?(n="ASC",$(".sort_down").css("background-position","-40px 0")):(n="DESC",$(".sort_down").css("background-position","-30px 0")),u=!u,d?r(1,n):$.ajax({type:"get",url:"../api/list.php",async:!0,data:{page:1,num:c,typ:a,order:n},success:function(t){o(t)}})}),$(".search-btn").click(function(){d=!0,p=$("#keyword").val(),r(1,n)}),$("#list").on("click","li .p-buy a",function(){var t=$(this).parent().parent().attr("data-id"),i=$(this).parent().parent().find(".j_product_img").attr("src"),s=$(this).parent().parent().find(".p_name a").html(),a=1*$(this).parent().parent().find(".price strong").html().slice(1);$.ajax({type:"post",url:"../api/car.php",async:!0,data:{gid:t,gimg:i,ginfo:s,gprice:a,quantity:"1"},success:function(t){var i=JSON.parse(t),s=i.total[0]["SUM(quantity)"],a=i.sPrice[0]["SUM(sumprice)"];$(".totleNum b").html(s),$(".totlePrice").html(a)}})}),$("#list").on("click","li .p_img,li .p_info",function(){var t=$(this).parent().attr("data-id");console.log(t),window.open("detail.html?"+t)}),$.ajax({type:"get",url:"../api/price.php",async:!0,success:function(t){var i=JSON.parse(t),s=i.total[0]["SUM(quantity)"],a=i.sPrice[0]["SUM(sumprice)"];$(".totleNum b").html(s),$(".totlePrice").html(a)}})});