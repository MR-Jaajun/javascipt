"use strict";$(function(){function r(t,a){var n=$(t).parent().parent().parent().find("img").attr("src"),c=$(t).parent().parent().parent().find(".cart-t-info a").html(),e=1*$(t).parent().parent().parent().find(".cart-t-price").html().slice(1),r=1*$(t).parent().find("#goodsnum").val(),i=$(t).parent().parent().parent().data("id");"add"==a&&r++,"cut"==a&&r--,r<1&&(r=1,confirm("你确定要删除吗？")&&($.ajax({type:"get",url:"../api/carinfo.php",async:!0,data:{gid:i},success:function(){alert("删除成功")}}),$(this).parent().parent().parent().remove()));$(t).parent().find("#goodsnum").val(r),d(i,n,c,e,r);var p=$("body").find(".cart-t-check input"),s=0;p.each(function(t,a){$(a).is(":checked")&&(s+=$(a).parent().parent().find(".cart-t-price").data("price")*$(a).parent().parent().find("#goodsnum").val())}),console.log(s.toFixed(2));var o=e*r;$(t).parent().parent().parent().find(".cart-t-total").html("￥"+o.toFixed(2)),$(".allprice").html("总计（不含运费）：￥"+s.toFixed(2))}function d(t,a,n,c,e){$.ajax({type:"post",url:"../api/car2.php",async:!0,data:{gid:t,gimg:a,ginfo:n,gprice:c,quantity:e},success:function(){}})}function a(){var t=$("body").find(".cart-t-check input"),n=0;t.each(function(t,a){$(a).is(":checked")&&(n+=$(a).parent().parent().find(".cart-t-price").data("price")*$(a).parent().parent().find("#goodsnum").val())}),console.log(n.toFixed(2)),$(".allprice").html("总计（不含运费）：￥"+n.toFixed(2))}$.ajax({type:"get",url:"../api/carinfo.php",async:!0,success:function(t){!function(t){var a=JSON.parse(t).map(function(t){return'<tbody>\n\t\t\t\t\t\t<tr data-id="'+t.gid+'">\n\t\t\t                <td class="cart-t-check"><input type="checkbox"></td>\n\t\t\t                    <td class="cart-t-img"><a href="javascript:"><img src="'+t.gimg+'"></a></td>\n\t\t\t                    <td class="cart-t-info"><a href="javascript:">'+t.ginfo+'</a></td>\t\t                       \n\t\t\t                    <td class="cart-t-price" data-price="'+t.gprice+'">￥'+t.gprice+'</td>\n\t\t\t                    <td class="cart-t-num">\n\t\t\t                        <div class="quantity-form">\n\t\t\t                            <a href="javascript:;" class="decrement"></a>\n\t\t\t                            <input id="goodsnum" type="text" class="itxt" oldnum="1" value="'+t.quantity+'" >\n\t\t\t                            <a href="javascript:;" class="increment"></a>\n\t\t\t                        </div>\n\t\t\t                    </td>\n\t\t\t                    <td class="cart-t-total">￥'+t.sumprice+'</td>\n\t\t\t                    <td class="cart-t-spec">1盒/份</td>\n\t\t\t                    <td class="cart-t-opera">\n\t\t\t                        <a href="javascript:;" style="color: #444444;" id="del">删除</a>\n\t\t\t                    </td>\n                    \t\t</tr>\n\t\t\t\t\t\t</tbody>'}).join("");$("#res").html(a)}(t)}}),$("#res").on("click",".decrement",function(){r(this,"cut")}),$("#res").on("click",".increment",function(){r(this,"add")}),$("#res").on("blur","#goodsnum",function(){var t=$(this).parent().parent().parent().find("img").attr("src"),a=$(this).parent().parent().parent().find(".cart-t-info a").html(),n=1*$(this).parent().parent().parent().find(".cart-t-price").html().slice(1),c=$(this).parent().parent().parent().data("id"),e=$(this).parent().find("#goodsnum").val();e<0&&(e=1),$(this).parent().find("#goodsnum").val(e),d(c,t,a,n,e),r(this,"")}),$("#res").on("click","#del",function(){var t=$(this).parent().parent().data("id");confirm("你确定要删除吗？")&&($.ajax({type:"get",url:"../api/carinfo.php",async:!0,data:{gid:t},success:function(){alert("删除成功")}}),$(this).parent().parent().remove())}),$("#clear").click(function(){confirm("你确定要删除吗？")&&($.ajax({type:"get",url:"../api/delcar.php",async:!0,success:function(t){"yes"==t&&alert("清空购物车成功")}}),$("#res").find("tbody").remove(),$(".allprice").html("总计（不含运费）：￥"))}),$(".cart-footer").on("click",".chkAll",function(){var t=$(this).prop("checked");$("#res").find(".cart-t-check input").prop("checked",t),a()}),$("#res").on("click",".cart-t-check input",function(){$(".cart-t-check input:checked").size()==$(".cart-t-check input").size()?$(".chkAll").prop("checked",!0):$(".chkAll").prop("checked",!1),a()}),$("#del_choose").click(function(){$("body").find(".cart-t-check input").each(function(t,a){var n=$(a).parent().parent().data("id");$(a).is(":checked")&&$.ajax({type:"get",url:"../api/carinfo.php",async:!0,data:{gid:n},success:function(){$(a).parent().parent().remove()}})}),alert("删除成功")}),$("#btnSubmit").click(function(){getCookie("username")?alert("支付功能不会做啊，请谅解谅解！"):confirm("你还没有登录哦，点击确定跳转到登录页！")&&(location.href="login.html?")})});